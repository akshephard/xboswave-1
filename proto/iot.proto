syntax = "proto3";

//This is designed to be included by the main xbos proto file and includes the
//definitions for the XBOS IoT devices
//
//Maintainer: Gabe Fierro
//Version 1.0
package xbospb;

import "nullabletypes.proto";


message URI {
    string namespace = 1;
    string value = 2;
}

message Triple {
    URI subject = 1;
    URI predicate = 2;
    URI object = 3;
}

enum FanMode {
    FanAuto = 0;
    FanOn = 1;
    FanOff = 2;
}

enum HVACMode {
    HVACModeOff = 0;
    HVACModeHeatOnly = 1;
    HVACModeCoolOnly = 2;
    HVACModeAuto = 3;
}

enum HVACState {
    HVACStateOff = 0;
    HVACStateHeatStage1 = 1;
    HVACStateCoolStage1 = 2;
    HVACStateHeatStage2 = 3;
    HVACStateCoolStage2 = 4;
}

message XBOSIoTDeviceState {
    // current time at device/service
    //unit:ns
    uint64 time = 1;
    // unique identifier for this request; used to line up with device state requests
    int64 requestid = 2;
    // any error that occured since the last device report. If requestid above is non-zero,
    // then this error corresponds to the request with the given requestid
    string error = 3;

    // XBOS IoT devices
    Thermostat thermostat = 4;
    Meter meter = 5;
    Light light = 6;
    EVSE evse = 7;
    WeatherStation weather_station = 8;
    WeatherStationPrediction weather_station_prediction = 9;
    ParkerState parker_state = 10;
}


message XBOSIoTDeviceActuation {
    // current time at device/service
    //unit:ns
    uint64 time = 1;
    // unique identifier for this request; used to line up with device state responses
    int64 requestid = 2;

    // XBOS IoT devices
    Thermostat thermostat = 3;
    Meter meter = 4;
    Light light = 5;
    EVSE evse = 6;
}

message XBOSIoTContext {
    // current time at device/service
    //unit:ns
    uint64 time = 1;
    // any triples this device wants to add about itself
    // these triples will be assumed to be generated by the entity
    // who has created/signed this message
    repeated Triple context = 2;
}

// Thermostat
message Thermostat {
    //Current temperature recorded by thermostat
    //unit:celsius
    Double temperature = 1;
    //unit:% rh
    Double relative_humidity = 2;
    //If true, then the thermostat is in override mode
    //unit: t/f
    Bool override = 3;
    //If true, the fan is on; else it is off
    //unit: t/f
    Bool fan_state = 4;
    //Current operating mode of the fan
    //unit: xbos/iot/FanMode
    FanMode fan_mode = 5;
    //Current operating mode of the HVAC
    //unit: xbos/iot/HVACMode
    HVACMode mode = 6;
    //Current HVAC state
    //unit: xbos/iot/HVACState
    HVACState state = 7;
    //number of heat stages enabled
    Int32 enabled_heat_stages = 8;
    //number of cool stages enabled
    Int32 enabled_cool_stages = 9;
    //heating setpoint
    //unit: celsius
    Double heating_setpoint = 10;
    //cooling setpoint
    //unit: celsius
    Double cooling_setpoint = 11;
}

message Meter {
    //unit: kW
    Double power = 1;
    //unit: V
    Double voltage = 2;
    //unit: kVA
    Double apparent_power = 3;
    //unit: KWh
    Double energy = 4;
}

message Light {
    // True if the light is on
    //unit: on/off
    Bool state = 1;
    // 100 is maximum brightness
    Int64 brightness = 2;
}

message EVSE {
    // maximum allowed current for charging
    //unit: A
    Double current_limit = 1;
    // active charge current
    //unit: A
    Double current = 2;
    // active charge voltage
    //unit: V
    Double voltage = 3;
    // seconds left until car is charged
    //unit: seconds
    Int32 charging_time_left = 4;
    // charge state of the EVSE
    //unit: on/off
    Bool state = 5;
}

message WeatherStation {
    // unit: celsius
    Double temperature = 1;
    // unit: unknown
    Double humidity = 2;
    // unit: km
    Double nearest_storm_distance = 3;
    // unit: degrees
    Int32 nearest_storm_bearing = 4;
    // precip intensity
    // unit: unknown
    Double precip_intensity = 5;
}

message WeatherStationPrediction {
    // time of the prediction (leave empty
    // unit: ns

    message Prediction {
        uint64 prediction_time = 1;
        WeatherStation prediction = 2;
    }

    repeated Prediction predictions = 1;
}
message ParkerState {
    //unit: hours
    Double compressor_working_hours = 1;
    //on/standby
    Int64 on_standby_status = 2;
    Int64 light_status = 3;
    Int64 aux_output_status = 4;
    //counter reduces periodically (in 1/4 of a minute)
    //unit: seconds
    Double next_defrost_counter = 5;
    //digital_io_status & 0x0001
    Bool door_switch_input_status = 6;
    //digital_io_status & 0x0002
    Bool multipurpose_input_status = 7;
    //digital_io_status & 0x0100
    Bool compressor_status = 8;
    //digital_io_status & 0x0200
    Bool output_defrost_status = 9;
    //digital_io_status & 0x0400
    Bool fans_status = 10;
    //digital_io_status & 0x0800
    Bool output_k4_status = 11;
    //temperature measured by cabinet probe (in 10x actual value)
    //unit: C
    Double cabinet_temperature = 12;
    //temperature measured by evaporator probe (in 10x actual value)
    //unit: C
    Double evaporator_temperature = 13;
    //temperature measured by auxiliary probe (if present) (in 10x actual value)
    //unit: C
    Double auxiliary_temperature = 14;
    //alarm_status & 0x0100
    Bool probe1_failure_alarm = 15;
    //alarm_status & 0x0200
    Bool probe2_failure_alarm = 16;
    //alarm_status & 0x0400
    Bool probe3_failure_alarm = 17;
    //alarm_status & 0x1000
    Bool minimum_temperature_alarm = 18;
    //alarm_status & 0x2000
    Bool maximum_temperture_alarm = 19;
    //alarm_status & 0x4000
    Bool condensor_temperature_failure_alarm = 20;
    //alarm_status & 0x8000
    Bool condensor_pre_alarm = 21;
    //alarm_status & 0x0004
    Bool door_alarm = 22;
    //alarm_status & 0x0008
    Bool multipurpose_input_alarm = 23;
    //alarm_status & 0x0010
    Bool compressor_blocked_alarm = 24;
    //alarm_status & 0x0020
    Bool power_failure_alarm = 25;
    //alarm_status & 0x0080
    Bool rtc_error_alarm = 26;
    //regulator_flag_1 & 0x0100
    Bool energy_saving_regulator_flag = 27;
    //regulator_flag_1 & 0x0200
    Bool energy_saving_real_time_regulator_flag = 28;
    //regulator_flag_1 & 0x0400
    Bool service_request_regulator_flag = 29;
    //regulator_flag_2 & 0x0001; 1=standby
    Bool on_standby_regulator_flag = 30;
    //regulator_flag_2 & 0x0080
    Bool new_alarm_to_read_regulator_flag = 31;
    //regulator_flag_2 & 0x0700; 0/1/2/3 = no defrost active/defrost running/dripping/fans stop
    Bool defrost_status_regulator_flag = 32;
    //time remaining to next defrost
    //unit: seconds
    Double time_until_defrost = 33;
    //current defrost counter countdown (in 1/4 of a minute)
    //unit: seconds
    Double current_defrost_counter = 34;
    //compressor delay in seconds
    //unit: seconds
    Double compressor_delay = 35;
    //is energy saving mode active or not; digital_output_flags & 0x0100
    Bool energy_saving_status = 36;
    //digital_output_flags & 0x0200
    Bool service_request_status = 37;
    //digital_output_flags & 0x001
    Bool resistors_activated_by_aux_key_status = 38;
    //digital_output_flags & 0x002
    Bool evaporator_valve_state = 39;
    //digital_output_flags & 0x004
    Bool output_defrost_state = 40;
    //digital_output_flags & 0x008
    Bool output_lux_state = 41;
    //digital_output_flags & 0x0010
    Bool output_aux_state = 42;
    //activated by cabinet probe; digital_output_flags & 0x0020
    Bool resistors_state = 43;
    //digital_output_flags & 0x0040
    Bool output_alarm_state = 44;
    //digital_output_flags & 0x0080
    Bool second_compressor_state = 45;
    //setpoint
    Double setpoint = 46;
    //min working setpoint
    //unit: C
    Double r1 = 47;
    //max working setpoint
    //unit: C
    Double r2 = 48;
    //used for active_set_point calculation in energy saving mode; adds to active setpoint
    Double r4 = 49;
    //compressor delay after turning on controller
    //unit: minutes
    Double C0 = 50;
    //min time between 2 activations in succession of compressor
    //unit: minutes
    Double C1 = 51;
    //defrost interval (only if d8 = 0/1/2); 0 = the defrost at intervals will never be activated
    //unit: hours
    Double d0 = 52;
    //defrost duration if P3=0 or 2; max duration if P3=1
    //unit: minutes
    Double d3 = 53;
    //defrost delay when you turn on controller; only if d4=1
    //unit: minutes
    Double d5 = 54;
    //drip delay
    //unit: minutes
    Double d7 = 55;
    //kind of defrost interval; 0/1/2/3=defrost on when controller/compressor/evaporator temperature is below d9  is on for d0 hours/realtime
    Int64 d8 = 56;
    //measured input for low temp alarm; 0/1/2=cab/evap/aux (only if P4=1/2)
    Int64 A0 = 57;
    //temperature below which low temperature alarm is activated
    //unit: C
    Double A1 = 58;
    //kind of lower temp alarm; 0/1/2=disabled/working setpoint-A1/absolute (or A1)
    Int64 A2 = 59;
    //measured input for high temp alarm; 0/1/2=cab/evap/aux (only if P4=1/2)
    Int64 A3 = 60;
    //temperature above which high temperature alarm is activated
    //unit: C
    Double A4 = 61;
    //kind of high temp alarm; 0/1/2=disabled/working setpoint+A4/absolute (or A4)
    Int64 A5 = 62;
    //high temperature alarm delay after turning on controller; only if A3=0
    //unit: minutes
    Double A6 = 63;
    //temperature alarm delay
    //unit: minutes
    Double A7 = 64;
    //high temperature alarm delay after end of defrost; only if A3=0
    //unit: minutes
    Double A8 = 65;
    //high temperature alarm delay after deactivation of microport input only if A3=0
    //unit: minutes
    Double A9 = 66;
    //evap fan activity during normal operation; 0/1/2/3/4=off/on/in parallel with compressor/dependent on F1/off if compressor is off and depedent on F1 if compressor is on
    Int64 F0 = 67;
    //evap temperature above which evap fan is turned off; only if F0=3/4
    //unit: C
    Double F1 = 68;
    //evap fan activity during defrost and drip delay; 0/1/2 = off/on/dependent on F0
    Int64 F2 = 69;
    //fan delay after evap drip completes
    //unit: minutes
    int64 F3 = 70;

}
